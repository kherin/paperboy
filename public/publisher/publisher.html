<!DOCTYPE html>
<html>
  <head>
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Publisher</title>
      <link rel="stylesheet" href="./css/bulma.min.css" />
    </head>
    <script>
      let messages = [];
      let currentIndex = 0;
      window.addEventListener("DOMContentLoaded", (event) => {
        let socket = new WebSocket("ws://localhost:8080");

        socket.onopen = function (e) {
          console.log("onopen: ", e);
        };

        socket.onmessage = function (event) {
          const value = event.data;
          messages = [...JSON.parse(value)];
        };

        socket.onclose = function (event) {
          console.log("onclose: ", event);
        };

        socket.onerror = function (error) {
          console.log("onerror: ", error);
        };
      });

      function rotateCard(messageData) {
        const { type, mediaType, message, author, image_url, exp} = messageData;
        
        document.querySelector('#typeContent').textContent = type;
        document.querySelector('#messageContent').textContent = message;
        document.querySelector('#authorContent').textContent = author || 'anonymous';
      }

      setInterval(function () {
        if ( messages.length ) {
          rotateCard(messages[currentIndex]);
          currentIndex = currentIndex + 1;
          if ( currentIndex == messages.length ) {
            currentIndex = 0;
          }
        }
      }, 6000);
    </script>
  </head>
  <body>
    <section class="hero is-success is-fullheight is-warning is-bold">
      <div class="hero-body">
        <div class="container is-fluid">
          <div class="tile">
            <div class="tile is-parent is-vertical">
              <article class="tile is-child notification">
                <div class="card">
                  <div class="card-content">
                    <div class="media pb-4">
                      <div class="media-left">
                        <figure class="image is-48x48">
                          <img src="./img/thumbs_up.png">
                        </figure>
                      </div>
                      <div class="media-content">
                        <p id="typeContent" class="title is-3">Kudos</p>
                      </div>
                    </div>
                    <p id="messageContent" class="title pb-6">
                      “There are two hard things in computer science: cache invalidation, naming things, and off-by-one errors.”
                    </p>
                    <p id="authorContent" class="subtitle">
                      Jeff Atwood
                    </p>
                  </div>
                  <footer class="card-footer">
                    <p class="card-footer-item">
                      <span>
                        <a href="https://xyz.test">https://xyz.test</a>
                      </span>
                    </p>
                  </footer>
                  </div>
                </div>
              </article>  
            </div>
        </div>
      </div>
    </section>
  </body>
</html>
